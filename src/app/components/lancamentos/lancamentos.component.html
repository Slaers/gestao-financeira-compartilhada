<div class="container mt-4">
  <h2>Novo Lançamento</h2>

  <div *ngIf="currentUser" class="mb-3">
    <p><strong>Registrando como:</strong> {{ currentUser.nome }}</p>
  </div>

  <form (ngSubmit)="onSubmit(lancamentoForm)" #lancamentoForm="ngForm">
    <div class="mb-3">
      <label for="descricao" class="form-label">Descrição</label>
      <input type="text" class="form-control" id="descricao" name="descricao" [(ngModel)]="model.descricao" required #descricao="ngModel">
      <div *ngIf="descricao.invalid && (descricao.dirty || descricao.touched)" class="alert alert-danger mt-1">
        Descrição é obrigatória.
      </div>
    </div>

    <div class="mb-3">
      <label for="valor" class="form-label">Valor (R$)</label>
      <input type="number" class="form-control" id="valor" name="valor" [(ngModel)]="model.valor" required #valor="ngModel" min="0.01">
      <div *ngIf="valor.invalid && (valor.dirty || valor.touched)" class="alert alert-danger mt-1">
        <span *ngIf="valor.errors?.['required']">Valor é obrigatório.</span>
        <span *ngIf="valor.errors?.['min']">Valor deve ser positivo.</span>
      </div>
    </div>

    <div class="mb-3">
      <label for="data" class="form-label">Data</label>
      <input type="date" class="form-control" id="data" name="data" [(ngModel)]="model.data" required #data="ngModel">
      <div *ngIf="data.invalid && (data.dirty || data.touched)" class="alert alert-danger mt-1">
        Data é obrigatória.
      </div>
    </div>

    <div class="mb-3">
      <label for="tipo" class="form-label">Tipo de Lançamento</label>
      <select class="form-select" id="tipo" name="tipo" [(ngModel)]="model.tipo" required #tipo="ngModel">
        <option value="receita">Receita</option>
        <option value="despesa">Despesa</option>
      </select>
      <div *ngIf="tipo.invalid && (tipo.dirty || tipo.touched)" class="alert alert-danger mt-1">
        Tipo de lançamento é obrigatório.
      </div>
    </div>

    <div class="mb-3">
      <label for="tipoPagamento" class="form-label">Tipo de Pagamento</label>
      <select class="form-select" id="tipoPagamento" name="tipoPagamento" [(ngModel)]="model.tipoPagamento" required #tipoPagamento="ngModel">
        <option value="" disabled>Selecione...</option>
        <option *ngFor="let tipo of tiposPagamento" [value]="tipo">{{ tipo }}</option>
      </select>
      <div *ngIf="tipoPagamento.invalid && (tipoPagamento.dirty || tipoPagamento.touched)" class="alert alert-danger mt-1">
        Tipo de pagamento é obrigatório.
      </div>
    </div>

    <div class="mb-3" *ngIf="model.tipo === 'despesa'">
      <label for="categoria" class="form-label">Categoria da Despesa (Opcional)</label>
      <input type="text" class="form-control" id="categoria" name="categoria" [(ngModel)]="model.categoria">
    </div>

    <button type="submit" class="btn btn-primary" [disabled]="lancamentoForm.invalid">Salvar Lançamento</button>
  </form>

  <div *ngIf="successMessage" class="alert alert-success mt-3">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger mt-3">
    {{ errorMessage }}
  </div>
</div>
